X-Git-Url: https://source.winehq.org/git/wine.git/blobdiff_plain/71d8edebb98201d1b74275b565e5c01d68c32e6d..90a094cc24a900687347af8f490c46617f9782df:/dlls/ole32/compobj.c

diff --git a/dlls/ole32/compobj.c b/dlls/ole32/compobj.c
index d136ee6..3da3c2f 100644
--- a/dlls/ole32/compobj.c
+++ b/dlls/ole32/compobj.c
@@ -4547,6 +4547,12 @@ HRESULT WINAPI CoWaitForMultipleHandles(DWORD dwFlags, DWORD dwTimeout,
                     }
                 }
 
+                if (!apt->win)
+                {
+                    /* If window is NULL on apartment, peek at messages so that it will not trigger
+                     * MsgWaitForMultipleObjects next time. */
+                    PeekMessageW(NULL, NULL, 0, 0, PM_QS_POSTMESSAGE | PM_NOREMOVE | PM_NOYIELD);
+                }
                 /* some apps (e.g. Visio 2010) don't handle WM_PAINT properly and loop forever,
                  * so after processing 100 messages we go back to checking the wait handles */
                 while (count++ < 100 && COM_PeekMessage(apt, &msg))
